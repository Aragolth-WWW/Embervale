# Session Notes — 2025-11-08 (Punch Setup)

Summary
- Goal: simple LMB punch (tap = light, hold = heavy) on the player using Synty + Mixamo clips.
- Result: Base-only controller path added, menus to build/assign, docs updated. Runtime still not punching on client — likely controller not built/assigned or FBX import (Humanoid) pending for the specific clips.

What works
- Player prefab loaded from Resources (`Player_Synty`).
- Networking bootstrap, host/client flow, camera rig, and controls.
- Animator Driver feeds locomotion params (MoveSpeed, Strafe X/Z, gait, grounded, crouch, etc.).
- Menus:
  - Build Player Combat Controller (Base Layer Only)
  - Build Player Combat Controller (Upper Layer)
  - Assign BaseOnly Controller To Player
  - Assign UpperLayer Controller To Player

What’s flaky / needs verification
- LMB punch (no transition observed). Common causes:
  1) Base-only controller not built yet (asset missing). Fix: run the Build Base Layer Only menu first.
  2) FBX clips not set to Humanoid (no preview/motion). Fix: set Rig = Humanoid (Create From This Model) and enable Animation import (Bake Into Pose Rotation/Y/XZ).
  3) Animator assigned on prefab is not the BaseOnly controller. Fix: run Assign BaseOnly menu and re-open prefab to confirm.
  4) Equipment gating: punches only when Unarmed and not aiming. Verify EquipmentState reports Unarmed and RMB is not held.

Quick start tomorrow (10 minutes)
- 1) Open both FBX clips:
  - `Assets/Game/Animation/Unarmed/A_Unarmed_Light_Punch.fbx`
  - `Assets/Game/Animation/Unarmed/A_Unarmed_Heavy_Punch.fbx`
  - Set Rig = Humanoid; Animation: Bake Into Pose (Rotation, Y, XZ). Ensure Preview plays on the grid.
- 2) Build & assign base-only controller:
  - Tools → Embervale → Animation → Build Player Combat Controller (Base Layer Only)
  - Tools → Embervale → Animation → Assign BaseOnly Controller To Player
  - Animator (Player prefab): Controller = `PlayerHumanoid_Combat_BaseOnly.controller`
- 3) Press Play and verify:
  - Animator window (player selected): `AttackLight`/`AttackHeavy` pulse on LMB tap/hold; Any State transitions fire to Unarmed_Light_Base/Heavy_Base.
  - If no pulse: check Input handling (Project Settings → Input System → Both), ensure editor has focus.
- 4) If still stuck: temporarily bypass Equipment gating by setting weapon type to Unarmed or removing EquipmentState component on the prefab for the test.

Optional polish after it works
- Restore upper-layer approach (arms-only mask) via Assign UpperLayer Controller menu for blending with locomotion.
- Tune light/heavy thresholds and durations in `SimpleAnimatorDriver`.
- Enable Foot IK (`Assets/Animation/Runtime/SimpleFootIK.cs`) and set Animator base layer “IK Pass”.

References
- README: Combat Animator (Build/Assign)
- Docs/KeybindsAndAnimation.md
- Docs/Troubleshooting/AnimationSetup.md
- Code: `Assets/Game/Animation/Editor/BuildCombatAnimator.cs`, `Assets/Networking/Runtime/SimpleAnimatorDriver.cs`
